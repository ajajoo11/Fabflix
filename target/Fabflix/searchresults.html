<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Results</title>
    <!-- Include necessary stylesheets -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
          integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/moviepage.css">
</head>

<body>

<div class="container mt-5">
    <div class="row">
        <div class="col">
            <h2 class="mb-4">Search Results</h2>
            <div class="form-group">
                <label for="sortOption">Sort by:</label>
                <select class="form-control" id="sortOption">
                    <option value="title_asc_rating_desc">Title (A-Z), Rating (High-Low)</option>
                    <option value="title_asc_rating_asc">Title (A-Z), Rating (Low-High)</option>
                    <option value="title_desc_rating_desc">Title (Z-A), Rating (High-Low)</option>
                    <option value="title_desc_rating_asc">Title (Z-A), Rating (Low-High)</option>
                    <option value="rating_asc_title_desc">Rating (Low-High), Title (Z-A)</option>
                    <option value="rating_asc_title_asc">Rating (Low-High), Title (A-Z)</option>
                    <option value="rating_desc_title_desc">Rating (High-Low), Title (Z-A)</option>
                    <option value="rating_desc_title_asc">Rating (High-Low), Title (A-Z)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="pageSize">Movies per Page:</label>
                <select class="form-control" id="pageSize">
                    <option value="10">10</option>
                    <option value="25">25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </div>
            <div class="col-md-6 text-right">
                <button class="btn btn-primary" id="prev_btn">Previous</button>
                <button class="btn btn-primary ml-2" id="next_btn">Next</button>
            </div>
            <div id="searchResults" class="list-group">
                <!-- Search results will be displayed here -->
            </div>
        </div>
    </div>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
    $(document).ready(function () {
        var pageNumber = 1; // Initialize page number
        var pageSize = 10; // Default page size

        // Function to fetch search results with sorting and pagination parameters
        function fetchSearchResults() {
            var title = getUrlParameter('title');
            var director = getUrlParameter('director');
            var year = getUrlParameter('year');
            var star = getUrlParameter('star');
            var sortOption = $('#sortOption').val();

            $.ajax({
                url: 'searchresults',
                method: 'GET',
                data: {
                    title: title,
                    director: director,
                    year: year,
                    star: star,
                    sort_option: sortOption,
                    pageSize: pageSize,
                    pageNumber: pageNumber
                },
                dataType: 'json',
                success: function (searchResults) {
                    displaySearchResults(searchResults);
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching search results:', status, error);
                    alert('Failed to fetch search results. Please try again later.');
                }
            });
        }

        // Function to display search results
        function displaySearchResults(searchResults) {
            var searchResultsContainer = $('#searchResults');
            searchResultsContainer.empty(); // Clear existing search results

            if (searchResults.length === 0) {
                searchResultsContainer.html("<p class='text-muted'>No results found.</p>");
            } else {
                $.each(searchResults, function (index, result) {
                    var resultHtml = "<a href='singlemoviepage.html?id=" + result.id + "' class='list-group-item list-group-item-action'>" +
                        "<h5 class='mb-1'>" + result.title + "</h5>" +
                        "<p class='mb-1'>Director: " + result.director + "</p>" +
                        "<small>Year: " + result.year + " | Rating: " + result.rating + "</small>" +
                        "</a>";

                    searchResultsContainer.append(resultHtml);
                });
            }
        }

        // Function to get URL parameter
        function getUrlParameter(name) {
            name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        }

        // Event listener for sorting option change
        $('#sortOption, #pageSize').change(function () {
            pageNumber = 1; // Reset page number to 1 when sorting or page size is changed
            pageSize = parseInt($('#pageSize').val());
            fetchSearchResults(); // Fetch search results with updated parameters
        });

        // Event listeners for Previous and Next buttons
        $('#prev_btn').click(function () {
            if (pageNumber > 1) {
                pageNumber--;
                fetchSearchResults(); // Fetch search results with updated page number
            }
        });

        $('#next_btn').click(function () {
            pageNumber++;
            fetchSearchResults(); // Fetch search results with updated page number
        });

        // Fetch search results with default parameters and sorting on page load
        fetchSearchResults();
    });
</script>

</body>

</html>
