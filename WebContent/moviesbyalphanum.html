<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies by Character</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/moviepage.css">
</head>

<body>

    <div class="container mt-5">
        <div class="row">
            <div class="col">
                <h2 class="mb-4">Movies by Character</h2>
                <div id="movieList" class="list-group">
                    <!-- Movie list will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            // Get the character from the query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const character = urlParams.get('charac');

            // Make AJAX request to servlet
            $.ajax({
                url: "moviesbyalphanum",
                method: "GET",
                data: { charac: character },
                dataType: "json",
                success: function (data) {
                    displayMovies(data);
                },
                error: function (xhr, status, error) {
                    console.error("Error fetching movies:", status, error);
                    alert("Failed to fetch movies. Please try again later.");
                }
            });

            // Function to display movies
            function displayMovies(movies) {
                const movieList = $("#movieList");

                if (movies.length === 0) {
                    movieList.append("<p class='text-muted'>No movies found for the character '" + character.toUpperCase() + "'</p>");
                } else {
                    const row = $("<div class='row'></div>");

                    // Loop through each movie and create movie card
                    movies.forEach(function (movie) {
                        const col = $("<div class='col-md-4 mb-4'></div>");
                        const card = $("<div class='card'></div>");
                        const cardBody = $("<div class='card-body'></div>");
                        const title = $("<h5 class='card-title'></h5>").html("<a href='singlemoviepage.html?id=" + movie.id + "'>" + movie.title + "</a>");
                        const director = $("<p class='card-text'>Director: " + movie.director + "</p>");
                        const year = $("<p class='card-text'>Year: " + movie.year + "</p>");
                        const rating = $("<p class='card-text'>Rating: " + movie.rating + "</p>");

                        cardBody.append(title, director, year, rating);
                        card.append(cardBody);
                        col.append(card);
                        row.append(col);
                    });

                    movieList.append(row);
                }
            }
        });
    </script>

</body>

</html>