<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movies by Genre</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>

<body>

    <div class="container">
        <h1 class="text-center mt-4 mb-5">Movies by Genre</h1>

        <div id="genreMovies" class="mb-4">
            <!-- Genre name will be dynamically added here -->
        </div>

        <table id="moviesTable" class="table table-bordered">
            <thead>
                <tr>
                    <th>Title</th>
                    <th>Year</th>
                    <th>Director</th>
                </tr>
            </thead>
            <tbody>
                <!-- Movies will be dynamically added here -->
            </tbody>
        </table>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function () {
            // Function to parse URL query parameters
            function getUrlParameter(name) {
                name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
                var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
                var results = regex.exec(location.search);
                return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
            };

            // Get genre ID from URL query parameter
            var genreId = getUrlParameter('id');

            // Fetch movies by genre from the server
            $.ajax({
                url: 'singlegenrepage?id=' + genreId,
                method: 'GET',
                dataType: 'json',
                success: function (movies) {
                    var genreMovies = $('#genreMovies');
                    var tbody = $('#moviesTable tbody');
                    $.each(movies, function (index, movie) {
                        var row = $('<tr>');
                        var titleLink = $('<a>').attr('href', 'singlemoviepage.html?id=' + encodeURIComponent(movie.id)).text(movie.title);
                        row.append($('<td>').append(titleLink));
                        row.append($('<td>').text(movie.year));
                        row.append($('<td>').text(movie.director));
                        tbody.append(row);
                    });
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching movies by genre:', status, error);
                    alert('Failed to fetch movies by genre. Please try again later.');
                }
            });
        });
    </script>

</body>

</html>